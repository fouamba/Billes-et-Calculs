
PLAN DE MIGRATION :

## ðŸ“Š Analyse de l'existant

### Structure actuelle
```
Billes-et-Calculs/
â”œâ”€â”€ frontend/              # Next.js (TypeScript)
â”‚   â”œâ”€â”€ src/              # Code source application
â”‚   â”œâ”€â”€ prisma/           # âš ï¸ ORM Ã  remplacer par Supabase
â”‚   â”œâ”€â”€ public/           # Assets statiques
â”‚   â”œâ”€â”€ docs/             # Documentation
â”‚   â”œâ”€â”€ playwright.config.ts  # Tests E2E âœ…
â”‚   â”œâ”€â”€ jest.config.json      # Tests unitaires âœ…
â”‚   â””â”€â”€ next.config.ts        # Config Next.js
â”œâ”€â”€ backend/              # â“ Vide - Ã€ dÃ©finir
â”œâ”€â”€ analytics/R/          # Scripts R pour RStudio âœ…
â”œâ”€â”€ prisma/               # âš ï¸ Doublon racine projet
â””â”€â”€ docker-compose.yml    # Dev local
```

### Points clÃ©s identifiÃ©s

**âœ… Ã€ conserver :**
- Structure Next.js complÃ¨te
- Configuration tests (Playwright + Jest)
- Scripts R analytics
- Docker Compose pour dev local

**âš ï¸ Ã€ migrer :**
- **Prisma â†’ Supabase Client**
  - Remplacer schÃ©ma Prisma par schÃ©ma SQL Supabase
  - Remplacer `prisma.user.findMany()` par `supabase.from('users').select()`
  - Conserver les types TypeScript

**âŒ Ã€ supprimer :**
- Dossier `prisma/` racine (doublon)
- `frontend/prisma/` (aprÃ¨s migration complÃ¨te)

**âž• Ã€ ajouter :**
- Configuration Supabase dans frontend
- Scripts dÃ©ploiement Coolify
- Connexion Learning Locker (xAPI)
- IntÃ©gration Ollama (IA)

## ðŸ—ï¸ Nouvelle architecture cible

### Frontend (Next.js sur Vercel)

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # App Router Next.js
â”‚   â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ register/page.tsx
â”‚   â”‚   â”œâ”€â”€ (game)/
â”‚   â”‚   â”‚   â”œâ”€â”€ level-1/page.tsx    # Client Component 3D
â”‚   â”‚   â”‚   â”œâ”€â”€ level-2/page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ level-3/page.tsx
â”‚   â”‚   â”œâ”€â”€ (teacher)/
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/page.tsx  # Server Component
â”‚   â”‚   â”‚   â”œâ”€â”€ students/page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ analytics/page.tsx
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ adaptive/route.ts   # Proxy Ollama
â”‚   â”‚   â”‚   â””â”€â”€ xapi/route.ts       # Proxy Learning Locker
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx                # Landing (SSR)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ game/
â”‚   â”‚   â”‚   â”œâ”€â”€ GameScene.tsx       # Canvas 3D
â”‚   â”‚   â”‚   â”œâ”€â”€ BallPhysics.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TeacherAvatar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ProblemUI.tsx
â”‚   â”‚   â”œâ”€â”€ teacher/
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalyticsChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StudentList.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SessionHistory.tsx
â”‚   â”‚   â””â”€â”€ ui/                     # Shadcn components
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts           # Client-side
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts           # Server-side
â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts       # Edge
â”‚   â”‚   â”œâ”€â”€ xapi/
â”‚   â”‚   â”‚   â””â”€â”€ statements.ts       # xAPI helpers
â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â””â”€â”€ adaptive.ts         # IA adaptative
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ gameStore.ts            # Zustand game state
â”‚   â”‚   â””â”€â”€ teacherStore.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ database.types.ts       # Generated by Supabase
â”‚   â”‚   â”œâ”€â”€ game.types.ts
â”‚   â”‚   â””â”€â”€ xapi.types.ts
â”‚   â””â”€â”€ hooks/
â”‚       â”œâ”€â”€ useAdaptiveDifficulty.ts
â”‚       â”œâ”€â”€ useGameSession.ts
â”‚       â””â”€â”€ useXAPI.ts
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ models/                     # 3D models (GLB/GLTF)
â”‚   â”œâ”€â”€ sounds/                     # Audio feedback
â”‚   â””â”€â”€ icons/
â”œâ”€â”€ supabase/                       # âš ï¸ Nouveau
â”‚   â”œâ”€â”€ migrations/                 # SQL migrations
â”‚   â””â”€â”€ seed.sql                    # DonnÃ©es initiales
â”œâ”€â”€ middleware.ts                   # Auth middleware
â”œâ”€â”€ next.config.ts
â””â”€â”€ package.json
```

### Backend (Coolify auto-hÃ©bergÃ©)

```
DÃ©ployÃ© via Coolify:
â”œâ”€â”€ Supabase Stack
â”‚   â”œâ”€â”€ PostgreSQL 15
â”‚   â”œâ”€â”€ PostgREST (API auto)
â”‚   â”œâ”€â”€ GoTrue (Auth)
â”‚   â”œâ”€â”€ Realtime (WebSocket)
â”‚   â””â”€â”€ Storage (S3-like)
â”œâ”€â”€ Learning Locker
â”‚   â”œâ”€â”€ MongoDB (statements)
â”‚   â”œâ”€â”€ Redis (cache)
â”‚   â””â”€â”€ API xAPI
â”œâ”€â”€ Ollama
â”‚   â”œâ”€â”€ Gemma 2B
â”‚   â”œâ”€â”€ Llama 3.2 3B
â”‚   â””â”€â”€ Phi-3 Mini
â””â”€â”€ RStudio Server
    â””â”€â”€ Scripts R analytics
```

## ðŸ”„ Plan de migration dÃ©taillÃ©

### Phase 1 : PrÃ©paration infrastructure (Semaine 1)

#### 1.1 DÃ©ploiement Coolify

```bash
# Sur votre serveur Coolify
# 1. DÃ©ployer Supabase
coolify deploy supabase \
  --postgres-password="votre_mot_de_passe_fort" \
  --jwt-secret="$(openssl rand -base64 32)" \
  --anon-key="$(supabase keys generate anon)" \
  --service-role-key="$(supabase keys generate service_role)"

# 2. DÃ©ployer Learning Locker
coolify deploy learning-locker \
  --mongo-password="mot_de_passe_mongo" \
  --app-secret="$(openssl rand -base64 32)"

# 3. DÃ©ployer Ollama
coolify deploy ollama \
  --memory=8G \
  --models="gemma2:2b,llama3.2:3b,phi3:mini"

# 4. DÃ©ployer RStudio
coolify deploy rstudio \
  --password="mot_de_passe_rstudio"
```

#### 1.2 Configuration DNS

```
supabase.ceredis.net  â†’ IP Coolify (port 8000)
lrs.ceredis.net       â†’ IP Coolify (port 8080)
rstudio.ceredis.net   â†’ IP Coolify (port 8787)
```

### Phase 2 : Migration Prisma â†’ Supabase (Semaine 2)

#### 2.1 Extraire le schÃ©ma Prisma existant

```bash
cd frontend
# GÃ©nÃ©rer le SQL depuis Prisma
npx prisma migrate diff \
  --from-empty \
  --to-schema-datamodel prisma/schema.prisma \
  --script > supabase/migrations/00_init.sql
```

#### 2.2 Adapter pour Supabase

```sql
-- supabase/migrations/01_initial_schema.sql

-- Extension UUID
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Users (gÃ©rÃ© par Supabase Auth automatiquement)
-- auth.users existe dÃ©jÃ 

-- Student Profiles
CREATE TABLE student_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  first_name TEXT NOT NULL,
  last_name TEXT NOT NULL,
  date_of_birth DATE,
  class_id UUID REFERENCES classes(id),
  adaptive_level INTEGER DEFAULT 1 CHECK (adaptive_level BETWEEN 1 AND 3),
  current_max_value INTEGER DEFAULT 5,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Classes
CREATE TABLE classes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL,
  teacher_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  school_year TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Game Sessions
CREATE TABLE game_sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  level INTEGER NOT NULL CHECK (level BETWEEN 1 AND 3),
  module INTEGER DEFAULT 1,
  start_time TIMESTAMPTZ DEFAULT NOW(),
  end_time TIMESTAMPTZ,
  score INTEGER DEFAULT 0,
  problems_attempted INTEGER DEFAULT 0,
  problems_correct INTEGER DEFAULT 0,
  badge_earned BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Problems Attempted
CREATE TABLE problems_attempted (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id UUID REFERENCES game_sessions(id) ON DELETE CASCADE,
  problem_number INTEGER NOT NULL,
  problem_type TEXT NOT NULL CHECK (problem_type IN ('composition', 'decomposition')),
  total_value INTEGER NOT NULL,
  part1_value INTEGER NOT NULL,
  part2_value INTEGER NOT NULL,
  unknown_position TEXT NOT NULL CHECK (unknown_position IN ('total', 'part1', 'part2')),
  user_answer INTEGER,
  expected_answer INTEGER NOT NULL,
  is_correct BOOLEAN,
  attempts INTEGER DEFAULT 1,
  duration_ms INTEGER,
  hints_requested INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Badges
CREATE TABLE badges (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT UNIQUE NOT NULL,
  description TEXT,
  icon_url TEXT,
  criteria JSONB NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE user_badges (
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  badge_id UUID REFERENCES badges(id) ON DELETE CASCADE,
  earned_at TIMESTAMPTZ DEFAULT NOW(),
  PRIMARY KEY (user_id, badge_id)
);

-- Strategies (pour recherche)
CREATE TABLE strategies_detected (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  problem_id UUID REFERENCES problems_attempted(id) ON DELETE CASCADE,
  strategy_type TEXT NOT NULL,
  confidence DECIMAL(3,2) DEFAULT 0.5,
  detected_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes pour performance
CREATE INDEX idx_sessions_user ON game_sessions(user_id, created_at DESC);
CREATE INDEX idx_problems_session ON problems_attempted(session_id, problem_number);
CREATE INDEX idx_student_profiles_class ON student_profiles(class_id);

-- Row Level Security (RLS)
ALTER TABLE student_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE game_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE problems_attempted ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_badges ENABLE ROW LEVEL SECURITY;

-- Policies: Students see only their data
CREATE POLICY "Students view own profile"
  ON student_profiles FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Students view own sessions"
  ON game_sessions FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Students insert own sessions"
  ON game_sessions FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Students view own problems"
  ON problems_attempted FOR SELECT
  USING (
    session_id IN (
      SELECT id FROM game_sessions WHERE user_id = auth.uid()
    )
  );

-- Policies: Teachers see their students
CREATE POLICY "Teachers view their students"
  ON student_profiles FOR SELECT
  USING (
    class_id IN (
      SELECT id FROM classes WHERE teacher_id = auth.uid()
    )
  );

CREATE POLICY "Teachers view their classes sessions"
  ON game_sessions FOR SELECT
  USING (
    user_id IN (
      SELECT id FROM student_profiles 
      WHERE class_id IN (
        SELECT id FROM classes WHERE teacher_id = auth.uid()
      )
    )
  );

-- Functions utilitaires
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_student_profiles_updated_at
  BEFORE UPDATE ON student_profiles
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at();
```

#### 2.3 GÃ©nÃ©rer types TypeScript

```bash
# Installer Supabase CLI
npm install -g supabase

# Se connecter au projet Supabase
supabase link --project-ref votre-project-ref

# GÃ©nÃ©rer les types
supabase gen types typescript --project-id votre-project-ref > src/types/database.types.ts
```

#### 2.4 Remplacer Prisma Client par Supabase

**Avant (Prisma) :**
```typescript
// lib/prisma.ts
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

export async function getStudents() {
  return await prisma.studentProfile.findMany({
    include: { gameSessions: true }
  })
}
```

**AprÃ¨s (Supabase) :**
```typescript
// lib/supabase/client.ts
import { createClientComponentClient } from '@supabase/auth-helpers-nextjs'
import { Database } from '@/types/database.types'

export const createClient = () => createClientComponentClient<Database>()

// lib/supabase/server.ts
import { createServerComponentClient } from '@supabase/auth-helpers-nextjs'
import { cookies } from 'next/headers'
import { Database } from '@/types/database.types'

export const createServerClient = () => 
  createServerComponentClient<Database>({ cookies })

// Usage dans Server Component
export async function getStudents() {
  const supabase = createServerClient()
  
  const { data, error } = await supabase
    .from('student_profiles')
    .select(`
      *,
      game_sessions(*)
    `)
  
  if (error) throw error
  return data
}
```

### Phase 3 : IntÃ©gration des nouvelles fonctionnalitÃ©s (Semaines 3-4)

#### 3.1 Configuration xAPI (Learning Locker)

```typescript
// lib/xapi/client.ts
import TinCan from 'tincanjs'

const lrs = new TinCan.LRS({
  endpoint: process.env.NEXT_PUBLIC_LRS_ENDPOINT!,
  username: process.env.NEXT_PUBLIC_LRS_KEY!,
  password: process.env.NEXT_PUBLIC_LRS_SECRET!,
  allowFail: false
})

export async function sendStatement(statement: TinCan.Statement) {
  return new Promise((resolve, reject) => {
    lrs.saveStatement(statement, {
      callback: (err, xhr) => {
        if (err) reject(err)
        else resolve(xhr)
      }
    })
  })
}

// lib/xapi/statements.ts
import { sendStatement } from './client'

export async function trackProblemAnswered({
  studentEmail,
  studentName,
  problemId,
  problemDescription,
  isCorrect,
  userAnswer,
  level,
  problemType,
  attempts,
  durationMs
}: ProblemAnsweredParams) {
  const statement = {
    actor: {
      mbox: `mailto:${studentEmail}`,
      name: studentName
    },
    verb: {
      id: 'http://adlnet.gov/expapi/verbs/answered',
      display: { 'fr-FR': 'a rÃ©pondu' }
    },
    object: {
      id: `http://billes-calculs.fr/problem/${problemId}`,
      definition: {
        name: { 'fr-FR': 'ProblÃ¨me de structure additive' },
        description: { 'fr-FR': problemDescription },
        type: 'http://adlnet.gov/expapi/activities/cmi.interaction'
      }
    },
    result: {
      success: isCorrect,
      response: String(userAnswer),
      duration: `PT${(durationMs / 1000).toFixed(1)}S`,
      score: {
        scaled: isCorrect ? 1 : 0
      }
    },
    context: {
      extensions: {
        'http://billes-calculs.fr/extensions/level': level,
        'http://billes-calculs.fr/extensions/problem-type': problemType,
        'http://billes-calculs.fr/extensions/attempts': attempts
      }
    }
  }
  
  await sendStatement(statement)
}
```

#### 3.2 IntÃ©gration IA Adaptative (Ollama)

```typescript
// app/api/adaptive/hint/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs'
import { cookies } from 'next/headers'

export async function POST(request: NextRequest) {
  const supabase = createRouteHandlerClient({ cookies })
  
  // Auth check
  const { data: { session } } = await supabase.auth.getSession()
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }
  
  const { problemContext, recentErrors } = await request.json()
  
  // Appel Ollama via Supabase Edge Function
  const { data, error } = await supabase.functions.invoke('adaptive-hint', {
    body: { 
      userId: session.user.id,
      problemContext, 
      recentErrors 
    }
  })
  
  if (error) {
    console.error('Ollama error:', error)
    return NextResponse.json({ error: 'IA unavailable' }, { status: 500 })
  }
  
  // Track hint in xAPI
  await trackHintRequested({
    studentEmail: session.user.email!,
    studentName: session.user.user_metadata.full_name,
    problemId: problemContext.id,
    hintText: data.hint
  })
  
  return NextResponse.json(data)
}

// Hook React pour utiliser l'IA
// hooks/useAdaptiveHint.ts
import { useMutation } from '@tanstack/react-query'

export function useAdaptiveHint() {
  return useMutation({
    mutationFn: async ({ problemContext, recentErrors }) => {
      const res = await fetch('/api/adaptive/hint', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ problemContext, recentErrors })
      })
      
      if (!res.ok) throw new Error('Failed to get hint')
      return res.json()
    }
  })
}
```

#### 3.3 Supabase Edge Function (interface avec Ollama)

```typescript
// supabase/functions/adaptive-hint/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const OLLAMA_URL = Deno.env.get('OLLAMA_URL') || 'http://ollama:11434'

serve(async (req) => {
  try {
    const { userId, problemContext, recentErrors } = await req.json()
    
    // RÃ©cupÃ©rer contexte Ã©tudiant depuis BDD
    const supabase = createClient(
      Deno.env.get('SUPABASE_URL')!,
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
    )
    
    const { data: history } = await supabase
      .from('problems_attempted')
      .select('*')
      .eq('session_id', (
        await supabase
          .from('game_sessions')
          .select('id')
          .eq('user_id', userId)
          .order('created_at', { ascending: false })
          .limit(1)
          .single()
      ).data.id)
      .order('created_at', { ascending: false })
      .limit(5)
    
    // Construire prompt contextuel
    const prompt = `Tu es un tuteur pÃ©dagogique bienveillant pour un Ã©lÃ¨ve de CP (6-7 ans).

ProblÃ¨me actuel: ${problemContext.description}
Valeurs: total=${problemContext.total}, part1=${problemContext.part1}, part2=${problemContext.part2}

Historique rÃ©cent:
${history?.map(h => `- ${h.problem_type}: ${h.is_correct ? 'âœ“' : 'âœ—'} (${h.attempts} essais)`).join('\n')}

GÃ©nÃ¨re un SEUL indice progressif et bienveillant (1-2 phrases maximum), sans donner la rÃ©ponse directement.
Adapte le vocabulaire Ã  un enfant de 6 ans.`

    // Appel Ollama
    const response = await fetch(`${OLLAMA_URL}/api/generate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'gemma2:2b',
        prompt,
        stream: false,
        options: {
          temperature: 0.7,
          num_predict: 100
        }
      })
    })
    
    const { response: hint } = await response.json()
    
    return new Response(JSON.stringify({ hint }), {
      headers: { 'Content-Type': 'application/json' }
    })
    
  } catch (error) {
    console.error('Edge function error:', error)
    return new Response(JSON.stringify({ error: error.message }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' }
    })
  }
})
```

### Phase 4 : Tests et dÃ©ploiement (Semaine 5)

#### 4.1 Tests automatisÃ©s

```typescript
// __tests__/game/problem-generation.test.ts
import { describe, it, expect } from '@jest/globals'
import { generateProblem } from '@/lib/game/problemGenerator'

describe('Problem Generation', () => {
  it('should generate composition problem', () => {
    const problem = generateProblem('composition', 10)
    
    expect(problem.type).toBe('composition')
    expect(problem.total).toBeLessThanOrEqual(10)
    expect(problem.part1 + problem.part2).toBe(problem.total)
    expect(problem.unknownPosition).toBe('total')
  })
  
  it('should generate decomposition problem', () => {
    const problem = generateProblem('decomposition', 10)
    
    expect(problem.type).toBe('decomposition')
    expect(problem.unknownPosition).toMatch(/part1|part2/)
  })
})

// __tests__/e2e/game-flow.spec.ts (Playwright)
import { test, expect } from '@playwright/test'

test('complete game session level 1', async ({ page }) => {
  // Login
  await page.goto('/login')
  await page.fill('[name="email"]', 'student@test.fr')
  await page.fill('[name="password"]', 'password')
  await page.click('button[type="submit"]')
  
  // Start level 1
  await page.goto('/game/level-1')
  await expect(page.locator('canvas')).toBeVisible()
  
  // Complete 5 problems
  for (let i = 0; i < 5; i++) {
    await page.waitForSelector('[data-testid="problem-input"]')
    await page.fill('[data-testid="problem-input"]', '5')
    await page.click('[data-testid="submit-answer"]')
    await page.waitForTimeout(2000) // Animation feedback
  }
  
  // Check badge earned
  await expect(page.locator('[data-testid="badge-notification"]')).toBeVisible()
})
```

#### 4.2 Configuration Vercel

```json
// vercel.json
{
  "buildCommand": "cd frontend && npm run build",
  "outputDirectory": "frontend/.next",
  "framework": "nextjs",
  "installCommand": "cd frontend && npm install",
  "env": {
    "NEXT_PUBLIC_SUPABASE_URL": "@supabase-url",
    "NEXT_PUBLIC_SUPABASE_ANON_KEY": "@supabase-anon-key",
    "NEXT_PUBLIC_LRS_ENDPOINT": "@lrs-endpoint",
    "NEXT_PUBLIC_LRS_KEY": "@lrs-key",
    "NEXT_PUBLIC_LRS_SECRET": "@lrs-secret"
  },
  "regions": ["cdg1"]
}
```

```bash
# DÃ©ploiement
cd frontend
vercel --prod

# Configuration variables
vercel env add NEXT_PUBLIC_SUPABASE_URL production
vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY production
# ... autres variables
```

## ðŸ“ Checklist de migration complÃ¨te

### Infrastructure
- [ ] Coolify configurÃ© et accessible
- [ ] Supabase dÃ©ployÃ© sur Coolify
- [ ] Learning Locker dÃ©ployÃ©
- [ ] Ollama dÃ©ployÃ© avec modÃ¨les
- [ ] RStudio Server dÃ©ployÃ©
- [ ] DNS configurÃ©s (4 sous-domaines)
- [ ] SSL Let's Encrypt actif

### Base de donnÃ©es
- [ ] Migration SQL Supabase exÃ©cutÃ©e
- [ ] RLS policies testÃ©es
- [ ] Indexes crÃ©Ã©s
- [ ] DonnÃ©es de test insÃ©rÃ©es
- [ ] Backup automatique configurÃ©

### Frontend
- [ ] Prisma supprimÃ© complÃ¨tement
- [ ] Supabase Client intÃ©grÃ©
- [ ] xAPI client configurÃ©
- [ ] Middleware auth fonctionnel
- [ ] Types TypeScript gÃ©nÃ©rÃ©s
- [ ] Components 3D migrÃ©s
- [ ] Tests passent (Jest + Playwright)

### FonctionnalitÃ©s
- [ ] Authentification (login/register)
- [ ] Jeu niveau 1 fonctionnel
- [ ] Jeu niveau 2 fonctionnel
- [ ] Jeu niveau 3 fonctionnel
- [ ] IA adaptative opÃ©rationnelle
- [ ] xAPI tracking actif
- [ ] Dashboard enseignant
- [ ] SystÃ¨me badges

### DÃ©ploiement
- [ ] Frontend dÃ©ployÃ© sur Vercel
- [ ] Variables d'environnement configurÃ©es
- [ ] CI/CD GitHub Actions (optionnel)
- [ ] Monitoring Grafana actif
- [ ] Logs Loki fonctionnels
- [ ] Documentation mise Ã  jour

## ðŸŽ¯ Prochaines Ã©tapes immÃ©diates

1. **GÃ©nÃ©rer le code de migration complet** (remplacement Prisma â†’ Supabase) 
2. **CrÃ©er les scripts de dÃ©ploiement Coolify** dÃ©taillÃ©s 
3. **DÃ©velopper les composants manquants** (3D, dashboard, etc.)
4. **Ã‰tablir un planning dÃ©taillÃ© semaine par semaine** 
